#! Generated by VisualDCT v2.6
#! DBDSTART
#! DBD("../../dbd/NSLS-II-SST1.dbd")
#! DBDEND



record(mbbo, "$(SYS){$(DEV)-$(AXIS)}Phs:Mode-SP") {
  field(DESC, "Phase mode set-point")
  field(SCAN, "Passive")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(TWVL, "2")
  field(THVL, "3")
  field(ZRST, "Parallel TI-BO")
  field(ONST, "Parallel TO-BI")
  field(TWST, "Antiparallel TI-BO")
  field(THST, "Antiparallel TO-BI")
  field(DTYP, "asynInt32")
  field(OUT, "@asyn(PMAC_REG_PORT)var(P401)")
}

record(mbbi, "$(SYS){$(DEV)-$(AXIS)}Phs:Mode-RB") {
  field(DESC, "Phase mode read-back")
  field(SCAN, "5 second")
  field(DTYP, "asynInt32")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(TWVL, "2")
  field(THVL, "3")
  field(ZRST, "Parallel TI-BO")
  field(ONST, "Parallel TO-BI")
  field(TWST, "Antiparallel TI-BO")
  field(THST, "Antiparallel TO-BI")
  field(PINI, "RUNNING")
  field(INP, "@asyn(PMAC_REG_PORT)var(P402)")
}

record(motor, "$(SYS){$(DEV)-$(AXIS)}-Mtr") {
  field(DTYP, "asynMotor")
  field(OUT, "@asyn($(COORDPORT),$(S))")
  field(EGU, "um")
  field(DESC, "Phase virtual motor")
  field(MRES, "$(MRES)")
  field(RTRY, "0")
  field(NTM, "NO")
  field(VELO, "$(VELOCITY)")
  field(ACCL, "$(ACCEL)")
  field(PREC, "2")
}

record(ai, "$(SYS){$(DEV)-$(AXIS)}MaxEngPhase-RB") {
  field(DTYP, "asynFloat64")
  field(DESC, "Maximum Eng. Phase")
  field(SCAN, "Passive")
  field(EGU, "um")
  field(PINI, "RUNNING")
  field(INP, "@asyn(PMAC_REG_PORT)var(P1033)scale($(CTS_PER_EGU))")
  field(PREC, "2")
}

record(ao, "$(SYS){$(DEV)-$(AXIS)}MaxEngPhase-SP") {
  field(DTYP, "asynFloat64")
  field(DESC, "Maximum Eng. Phase")
  field(SCAN, "Passive")
  field(FLNK, "$(SYS){$(DEV)-$(AXIS)}MaxEngPhase-RB")
  field(EGU, "um")
  field(OUT, "@asyn(PMAC_REG_PORT)var(P1033)scale($(CTS_PER_EGU))")
  field(PREC, "2")
}

record(ai, "$(SYS){$(DEV)-$(AXIS)}MaxOpPhase-RB") {
  field(DTYP, "asynFloat64")
  field(DESC, "Maximum Op. Phase")
  field(SCAN, "Passive")
  field(EGU, "um")
  field(PINI, "RUNNING")
  field(INP, "@asyn(PMAC_REG_PORT)var(P1034)scale($(CTS_PER_EGU))")
  field(FLNK, "$(SYS){$(DEV)-$(AXIS)}-Trans-Limits")
  field(PREC, "2")
}

record(ao, "$(SYS){$(DEV)-$(AXIS)}MaxOpPhase-SP") {
  field(DTYP, "asynFloat64")
  field(DESC, "Maximum Op. Phase")
  field(SCAN, "Passive")
  field(FLNK, "$(SYS){$(DEV)-$(AXIS)}MaxOpPhase-RB")
  field(EGU, "um")
  field(OUT, "@asyn(PMAC_REG_PORT)var(P1034)scale($(CTS_PER_EGU))")
  field(PREC, "2")
}

record(transform, "$(SYS){$(DEV)-$(AXIS)}-Trans-Limits") {
  field(SCAN, "Passive")
  field(CLCA, "A")
  field(CLCB, "A")
  field(INPA, "$(SYS){$(DEV)-$(AXIS)}MaxOpPhase-RB")
  field(OUTA, "$(SYS){$(DEV)-$(AXIS)}-Mtr-SP.DRVH")
  field(OUTB, "$(SYS){$(DEV)-$(AXIS)}-Mtr-SP.HOPR")
  field(CLCC, "-A")
  field(CLCD, "-A")
  field(OUTC, "$(SYS){$(DEV)-$(AXIS)}-Mtr-SP.DRVL")
  field(OUTD, "$(SYS){$(DEV)-$(AXIS)}-Mtr-SP.LOPR")
}

record(ao, "$(SYS){$(DEV)-$(AXIS)}-Mtr-SP") {
  field(DTYP, "asynFloat64")
  field(DESC, "Motor position setpoint,limits included.")
  field(OUT, "@asyn(PMAC_REG_PORT)var(P1117 )scale($(CTS_PER_EGU))")
  field(EGU, "um")
  field(PREC, "2")
  field(FLNK, "$(SYS){$(DEV)-$(AXIS)}-MtrCalc")
}

record(asyn, "$(SYS){$(DEV)-$(AXIS)}-MvReq-Cmd") {
  field(DESC, "Triggers PLC to start phase movement")
  field(SCAN, "Passive")
  field(DTYP, "asynRecordDevice")
  field(PORT, "$(PMACPORT)")
  field(ADDR, "-1")
  field(TMOD, "Write/Read")
  field(AOUT, "P1116=1")
}

record(transform, "$(SYS){$(DEV)-$(AXIS)}-MtrCalc") {
  field(INPA, "$(SYS){$(DEV)-$(AXIS)}-Mtr.VELO PP NMS")
  field(INPB, "$(SYS){$(DEV)-$(AXIS)}-Mtr.ACCL PP NMS")
  field(OUTA, "$(SYS){$(DEV)-$(AXIS)}-Mtr-VELO PP NMS")
  field(OUTB, "$(SYS){$(DEV)-$(AXIS)}-Mtr-ACCL PP NMS")
  field(FLNK, "$(SYS){$(DEV)-$(AXIS)}-MvReq-Cmd")
  field(CLCA, "A")
  field(CLCB, "B")
}

record(ao, "$(SYS){$(DEV)-$(AXIS)}-Mtr-VELO") {
  field(DTYP, "asynFloat64")
  field(DESC, "Sends motor VELO to PMAC")
  field(SCAN, "Passive")
  field(OUT, "@asyn(PMAC_REG_PORT)var(P1119)scale($(CTS_PER_EGU))")
  field(EGU, "um/s")
  field(PREC, "2")
}

record(ao, "$(SYS){$(DEV)-$(AXIS)}-Mtr-ACCL") {
  field(DTYP, "asynFloat64")
  field(DESC, "Sends motor ACCL to PMAC")
  field(SCAN, "Passive")
  field(OUT, "@asyn(PMAC_REG_PORT)var(P1120)")
  field(EGU, "um/s^2")
  field(PREC, "2")
}

#! Further lines contain data used by VisualDCT
#! View(706,0,1.0)
#! Record("$(SYS){$(DEV)-$(AXIS)}Phs:Mode-SP",260,817,0,1,"$(SYS){$(DEV)-$(AXIS)}Phs:Mode-SP")
#! Record("$(SYS){$(DEV)-$(AXIS)}Phs:Mode-RB",260,463,0,0,"$(SYS){$(DEV)-$(AXIS)}Phs:Mode-RB")
#! Record("$(SYS){$(DEV)-$(AXIS)}-Mtr",1280,245,0,0,"$(SYS){$(DEV)-$(AXIS)}-Mtr")
#! Field("$(SYS){$(DEV)-$(AXIS)}-Mtr.VELO",16777215,1,"$(SYS){$(DEV)-$(AXIS)}-Mtr.VELO")
#! Field("$(SYS){$(DEV)-$(AXIS)}-Mtr.ACCL",16777215,1,"$(SYS){$(DEV)-$(AXIS)}-Mtr.ACCL")
#! Record("$(SYS){$(DEV)-$(AXIS)}MaxEngPhase-RB",540,1146,0,1,"$(SYS){$(DEV)-$(AXIS)}MaxEngPhase-RB")
#! Record("$(SYS){$(DEV)-$(AXIS)}MaxEngPhase-SP",820,1126,0,0,"$(SYS){$(DEV)-$(AXIS)}MaxEngPhase-SP")
#! Field("$(SYS){$(DEV)-$(AXIS)}MaxEngPhase-SP.FLNK",16777215,0,"$(SYS){$(DEV)-$(AXIS)}MaxEngPhase-SP.FLNK")
#! Link("$(SYS){$(DEV)-$(AXIS)}MaxEngPhase-SP.FLNK","$(SYS){$(DEV)-$(AXIS)}MaxEngPhase-RB")
#! Record("$(SYS){$(DEV)-$(AXIS)}MaxOpPhase-RB",740,532,0,0,"$(SYS){$(DEV)-$(AXIS)}MaxOpPhase-RB")
#! Field("$(SYS){$(DEV)-$(AXIS)}MaxOpPhase-RB.FLNK",16777215,1,"$(SYS){$(DEV)-$(AXIS)}MaxOpPhase-RB.FLNK")
#! Link("$(SYS){$(DEV)-$(AXIS)}MaxOpPhase-RB.FLNK","$(SYS){$(DEV)-$(AXIS)}-Trans-Limits")
#! Field("$(SYS){$(DEV)-$(AXIS)}MaxOpPhase-RB.VAL",16777215,1,"$(SYS){$(DEV)-$(AXIS)}MaxOpPhase-RB.VAL")
#! Record("$(SYS){$(DEV)-$(AXIS)}MaxOpPhase-SP",760,806,0,0,"$(SYS){$(DEV)-$(AXIS)}MaxOpPhase-SP")
#! Field("$(SYS){$(DEV)-$(AXIS)}MaxOpPhase-SP.FLNK",16777215,0,"$(SYS){$(DEV)-$(AXIS)}MaxOpPhase-SP.FLNK")
#! Link("$(SYS){$(DEV)-$(AXIS)}MaxOpPhase-SP.FLNK","$(SYS){$(DEV)-$(AXIS)}MaxOpPhase-RB")
#! Record("$(SYS){$(DEV)-$(AXIS)}-Trans-Limits",1120,545,0,0,"$(SYS){$(DEV)-$(AXIS)}-Trans-Limits")
#! Field("$(SYS){$(DEV)-$(AXIS)}-Trans-Limits.INPA",16777215,0,"$(SYS){$(DEV)-$(AXIS)}-Trans-Limits.INPA")
#! Link("$(SYS){$(DEV)-$(AXIS)}-Trans-Limits.INPA","$(SYS){$(DEV)-$(AXIS)}MaxOpPhase-RB.VAL")
#! Field("$(SYS){$(DEV)-$(AXIS)}-Trans-Limits.OUTA",16777215,1,"$(SYS){$(DEV)-$(AXIS)}-Trans-Limits.OUTA")
#! Link("$(SYS){$(DEV)-$(AXIS)}-Trans-Limits.OUTA","$(SYS){$(DEV)-$(AXIS)}-Mtr-SP.DRVH")
#! Field("$(SYS){$(DEV)-$(AXIS)}-Trans-Limits.OUTB",16777215,1,"$(SYS){$(DEV)-$(AXIS)}-Trans-Limits.OUTB")
#! Link("$(SYS){$(DEV)-$(AXIS)}-Trans-Limits.OUTB","$(SYS){$(DEV)-$(AXIS)}-Mtr-SP.HOPR")
#! Field("$(SYS){$(DEV)-$(AXIS)}-Trans-Limits.OUTC",16777215,1,"$(SYS){$(DEV)-$(AXIS)}-Trans-Limits.OUTC")
#! Link("$(SYS){$(DEV)-$(AXIS)}-Trans-Limits.OUTC","$(SYS){$(DEV)-$(AXIS)}-Mtr-SP.DRVL")
#! Field("$(SYS){$(DEV)-$(AXIS)}-Trans-Limits.OUTD",16777215,1,"$(SYS){$(DEV)-$(AXIS)}-Trans-Limits.OUTD")
#! Link("$(SYS){$(DEV)-$(AXIS)}-Trans-Limits.OUTD","$(SYS){$(DEV)-$(AXIS)}-Mtr-SP.LOPR")
#! Record("$(SYS){$(DEV)-$(AXIS)}-Mtr-SP",1420,600,0,1,"$(SYS){$(DEV)-$(AXIS)}-Mtr-SP")
#! Field("$(SYS){$(DEV)-$(AXIS)}-Mtr-SP.DRVH",16777215,0,"$(SYS){$(DEV)-$(AXIS)}-Mtr-SP.DRVH")
#! Field("$(SYS){$(DEV)-$(AXIS)}-Mtr-SP.HOPR",16777215,0,"$(SYS){$(DEV)-$(AXIS)}-Mtr-SP.HOPR")
#! Field("$(SYS){$(DEV)-$(AXIS)}-Mtr-SP.DRVL",16777215,0,"$(SYS){$(DEV)-$(AXIS)}-Mtr-SP.DRVL")
#! Field("$(SYS){$(DEV)-$(AXIS)}-Mtr-SP.LOPR",16777215,0,"$(SYS){$(DEV)-$(AXIS)}-Mtr-SP.LOPR")
#! Field("$(SYS){$(DEV)-$(AXIS)}-Mtr-SP.FLNK",16777215,1,"$(SYS){$(DEV)-$(AXIS)}-Mtr-SP.FLNK")
#! Link("$(SYS){$(DEV)-$(AXIS)}-Mtr-SP.FLNK","$(SYS){$(DEV)-$(AXIS)}-MtrCalc")
#! Record("$(SYS){$(DEV)-$(AXIS)}-MvReq-Cmd",2100,646,0,0,"$(SYS){$(DEV)-$(AXIS)}-MvReq-Cmd")
#! Record("$(SYS){$(DEV)-$(AXIS)}-MtrCalc",1700,246,0,0,"$(SYS){$(DEV)-$(AXIS)}-MtrCalc")
#! Field("$(SYS){$(DEV)-$(AXIS)}-MtrCalc.INPA",16777215,0,"$(SYS){$(DEV)-$(AXIS)}-MtrCalc.INPA")
#! Link("$(SYS){$(DEV)-$(AXIS)}-MtrCalc.INPA","$(SYS){$(DEV)-$(AXIS)}-Mtr.VELO")
#! Field("$(SYS){$(DEV)-$(AXIS)}-MtrCalc.INPB",16777215,0,"$(SYS){$(DEV)-$(AXIS)}-MtrCalc.INPB")
#! Link("$(SYS){$(DEV)-$(AXIS)}-MtrCalc.INPB","$(SYS){$(DEV)-$(AXIS)}-Mtr.ACCL")
#! Field("$(SYS){$(DEV)-$(AXIS)}-MtrCalc.OUTA",16777215,1,"$(SYS){$(DEV)-$(AXIS)}-MtrCalc.OUTA")
#! Link("$(SYS){$(DEV)-$(AXIS)}-MtrCalc.OUTA","$(SYS){$(DEV)-$(AXIS)}-Mtr-VELO.VAL")
#! Field("$(SYS){$(DEV)-$(AXIS)}-MtrCalc.OUTB",16777215,1,"$(SYS){$(DEV)-$(AXIS)}-MtrCalc.OUTB")
#! Link("$(SYS){$(DEV)-$(AXIS)}-MtrCalc.OUTB","$(SYS){$(DEV)-$(AXIS)}-Mtr-ACCL.VAL")
#! Field("$(SYS){$(DEV)-$(AXIS)}-MtrCalc.FLNK",16777215,1,"$(SYS){$(DEV)-$(AXIS)}-MtrCalc.FLNK")
#! Link("$(SYS){$(DEV)-$(AXIS)}-MtrCalc.FLNK","$(SYS){$(DEV)-$(AXIS)}-MvReq-Cmd")
#! Record("$(SYS){$(DEV)-$(AXIS)}-Mtr-VELO",2100,120,0,1,"$(SYS){$(DEV)-$(AXIS)}-Mtr-VELO")
#! Field("$(SYS){$(DEV)-$(AXIS)}-Mtr-VELO.VAL",16777215,0,"$(SYS){$(DEV)-$(AXIS)}-Mtr-VELO.VAL")
#! Record("$(SYS){$(DEV)-$(AXIS)}-Mtr-ACCL",2100,320,0,1,"$(SYS){$(DEV)-$(AXIS)}-Mtr-ACCL")
#! Field("$(SYS){$(DEV)-$(AXIS)}-Mtr-ACCL.VAL",16777215,0,"$(SYS){$(DEV)-$(AXIS)}-Mtr-ACCL.VAL")
#! Box(Box0,220,140,960,400,0,16776960,Border0)
#! TextBox(TB0,240,160,940,380,0,"Dialog",26,1,16777215,"Phase movement\n\nAuthors: Ivo List, Miroslav Pavleski, Miha Vitoroviƒç\n\nCosylab d.d.\nhttp://www.cosylab.com",Border0)
#! TextBox(TB8,2100,600,2400,660,0,"Dialog",12,1,16777215,"This record writes a flag that notifies the movement request PLC (PLC 8) that it should execute new movement.\n",null)
#! TextBox(TB4,1280,120,1560,240,0,"Dialog",12,1,16777215,"NTM=\"NO\" and RTRY=0 is really important for CS motion.\n\nIt prevents inteligent motors, such as the virtual coordinate system PMAC motors from being interrupted by record processing.",null)
#! TextBox(TB3,1420,900,1820,1180,0,"Dialog",12,1,16777215,"HLM LLM on motor record are useless. Hence intermediate setpoint ao record is used to limit the values.\n\nIf motor record HLM is 240000 and user positions the motor at 240000 the motor goes to 240000 and stops. Then as the record processes with time it goes into infinite loop:\n\n - Record detects we are at limit\n - Sets LVIO to 1 (Limit violation flag)\n - Record detects LVIO is 1 , issues a stop\n - Stop clears LVIO to 0 \n - Repeat ...\n \nThis in essence prevents movement once we are at limit position. Every move command is interrupted by STOP request from the record.",null)
#! TextBox(TB2,220,440,640,460,0,"Dialog",12,1,16777215,"Reads the setting of the axis from PMAC",null)
#! TextBox(TB1,220,780,500,800,0,"Dialog",12,1,16777215,"Sends the new setting of axis to PMAC",null)
